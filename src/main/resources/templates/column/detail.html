<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/header :: head('칼럼 상세')}"></head>
<body>
<div th:replace="~{fragments/header :: navbar}"></div>

<main class="container">

  <article class="column-detail">

    <!-- 칼럼 헤더 -->
    <header class="column-header">
      <h1 class="column-title" th:text="${column.title}">칼럼 제목</h1>

      <div class="column-meta">
        <span class="column-author" th:text="${column.author.nickname}">작성자</span>
        <span class="column-date" th:text="${#temporals.format(column.createdAt, 'yyyy-MM-dd HH:mm')}">
          2025-01-01 12:00
        </span>
      </div>

      <!-- ADMIN 삭제 버튼 -->
      <form th:if="${loginUser != null and loginUser.role.name() == 'ADMIN'}"
            th:action="@{'/columns/' + ${column.id} + '/delete'}"
            method="post"
            class="column-delete-form">
        <button type="submit" class="btn-danger">칼럼 삭제</button>
      </form>
    </header>

    <!-- 칼럼 본문 -->
    <div class="column-content" th:text="${column.content}">
      칼럼 내용
    </div>
  </article>

  <!-- 댓글 섹션 -->
  <section class="card comments-section">
    <h2 class="section-title">댓글</h2>

    <!-- 댓글 작성 폼 -->
    <div th:if="${loginUser != null}">
      <form th:action="@{'/columns/' + ${column.id} + '/comments'}"
            method="post"
            class="comment-form">
        <textarea name="content" rows="3" class="form-textarea" placeholder="댓글을 입력하세요..."></textarea>
        <button type="submit" class="btn-primary">댓글 남기기</button>
      </form>
    </div>

    <div th:if="${loginUser == null}" class="login-prompt">
      <p>댓글을 남기려면 <a th:href="@{/login}" class="link-primary">로그인</a>이 필요합니다.</p>
    </div>

    <!-- 댓글 목록 -->
    <div th:if="${#lists.isEmpty(comments)}" class="empty-state">
      <p>아직 댓글이 없습니다.</p>
    </div>

    <div th:if="${!#lists.isEmpty(comments)}" class="comments-list">
      <div th:each="c : ${comments}" class="comment-item">
        <div class="comment-header">
          <a th:href="@{'/users/' + ${c.user.id}}" class="comment-author" th:text="${c.user.nickname}">닉네임</a>
        </div>

        <p class="comment-content" th:text="${c.content}">댓글 내용</p>

        <form th:if="${loginUser != null and (loginUser.id == c.user.id or loginUser.role.name() == 'ADMIN')}"
              th:action="@{'/columns/' + ${column.id} + '/comments/' + ${c.id} + '/delete'}"
              method="post">
          <button type="submit" class="btn-danger-small">삭제</button>
        </form>
      </div>
    </div>
  </section>

</main>
</body>
</html>
